<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="renderer" content="webkit">
  <meta content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="format-detection" content="telphone=no, email=no" />
  <title>商品详情</title>  
</head>
<style>
  .goodshead {
    position: relative;
    display: block;
  }
  .goodsimg {
    width: 100%;
    vertical-align: middle;
  }
  .nickicon {
    position: absolute;
    width:2rem;
    height:2rem;
    bottom: .8rem;
    left: 1rem;
    border-radius: 2rem;
  }
  .nickname {
    position: absolute;
    left: 3.3rem;
    bottom: 1.9rem;
    font-size: 14px;
    color: #eeeeee;
  }
  .time {
    position: absolute;
    left: 3.3rem;
    bottom: .7rem;
    font-size: 14px;
    color: #eeeeee;
  }
  .nback {
    position: absolute;
    bottom: 0;
    width:100%;
    height: 4.5rem;
  }
  .goodsInfo {
    position: relative;
    display: block;
    background: white;
    padding: 3.3rem .8rem .8rem .8rem;
  }
  .gname {
    position: absolute;
    font-size: 18px;
    left: .8rem;
    top:0.5rem;
    color: #2a3a49;
  }
  .gprice {
    position: absolute;
    color: red;
    right: .8rem;
    top:0.5rem;
    font-size: 20px;
    font-weight: 800;
  }
  .gdetail {
    position: absolute;
    font-size: 11px;
    left:.8rem;
    top: 2rem;
    color: #2a3a49;
  }
  .gtag {
    font-size: 11px;
    border:1px solid gray;
    border-radius: 1rem;
    height: 1rem;
    display: inline-block;
    margin-top: .3rem;
    padding: 4px 4px 4px 4px;
    margin-right: 5px;
  }
  .comemnttag {
    display: block;
    font-size: 16px;
    color: #2a3a49;
    padding: .5rem 0 0.5rem 1rem;
  }
  .list {
    position: relative;
    margin: 0;
    padding: 0;
    list-style-type: none;
  }
  .nickicon_c {
    position: absolute;
    width: 1.2rem;
    height: 1.2rem;
    left: .8rem;
    border-radius:1.2rem;
  }
  .comment {
    font-size: 10px;
    color: #2a3a49;
    width: 80%;
  }
  .download {
    position: fixed;
    bottom: 0;
    width: 100%;
    font-size: 1rem;
    line-height: 2.5rem;
    text-align: center;
    height: 2.5rem;
    background: orangered;
    color: #eeeeee;
  }
</style>

<body style="margin:0;padding:0;background: #EFF1F2;overflow-x: hidden;-webkit-user-select: initial;">
  <div class="_wraper">
    <div class="goodshead">
      <img src="" class="goodsimg" alt="">
      <img src="src/goods_detail.png" class="nback" alt="">
      <img src="" class="nickicon" alt="">
      <a class="nickname">昵称</a>
      <a class="time">23月20号</a>
    </div>
    <div class="goodsInfo">
      <a class="gname">商品名</a>
      <a class="gprice">&yen;0</a>
      <a class="gdetail">-人喜欢 -人喜欢</a>
      <a class="gtag">标签</a>
    </div>
    <div class="comemnttag">加载中...</div>
    <div>
      <ul class="list">
        <li style="padding: 0;margin-bottom: .5rem;">
          <img src="" class="nickicon_c">
          <div style="padding-left: 2.5rem;padding-right: 1rem;position: relative;word-break: break-all;">
            <a class="comment"></a>
          </div>
        </li>
      </ul>
    </div>
    <div style="height: 2.5rem;"></div>
    <div class="download"><span>App Store</span></div>
  </div> 
</body>

<script src="src/jquery.js" type="text/javascript"></script>
<script>
  function GetQueryString(name) {
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if(r!=null)return  unescape(r[2]); return null;
  }
  function fetchData() {
    var gid = GetQueryString("gid");
    var url = "http://121.42.204.170/main/?ct=api&method=goods.getGoodsByGid";
    $.post(url, {"gid":gid}, function(re){
      if (re) {
        var data = JSON.parse(re);
        if(data.c == "0") {
          var goods = data.d;
          $(".nickname").text(goods.nickname);
          $(".goodsimg").attr('src', goods.img);
          $(".nickicon").attr('src', goods.portrait);
          var date = new Date(parseInt(goods.ct)*1000);
          $(".time").text(date.toJSON());
          var goodsInfo = '<a class="gname">'+goods.name+'</a> <a class="gprice">&yen;'+goods.price+'</a> <a class="gdetail">'+goods.fav_count+'人喜欢 '+goods.purchased_count+'人购买</a>';
          if (goods.tag) {
            var tags = goods.tag.split(",");
            for (var i=0;i<tags.length;i++) {
              goodsInfo += '<a class="gtag">'+tags[i]+'</a>';
            }
          }
          $(".goodsInfo").html(goodsInfo);

        }
      }
    });

    var curl = "http://121.42.204.170/main/?ct=api&method=goods.getCommentList";
    $.post(curl, {"gid":gid, page:"1", num:"100"}, function(re){
      if (re) {
        var data = JSON.parse(re);
        if(data.c == "0") {
          var content = data.d;
          $('.comemnttag').text(content.count+"条评论");
          var list = "";
          for (var a=0;a<content.data.length;a++){
            list += '<li style="padding: 0;margin-bottom: .5rem;"><img src=\"'+content.data[a].portrait+'\" class="nickicon_c"><div style="padding-left: 2.5rem;padding-right: 1rem;position: relative;word-break: break-all;"><a class="comment">'+content.data[a].content+'</a></div></li>';
          }
          $('.list').html(list);
        }
      }
    });
  }
  fetchData();
</script>

</html>